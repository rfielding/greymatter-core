# Changelog

## vNext

### Added

- Add explicit securityContext for catalog, control, and redis for pod security admission.
- Introduced a configmap to configure catalog
- Added the `dashboard_url` field to the `#Connection` definition

### Changed

- Made the `#Connection` `url` field optional since it will get generated by the operator if empty
- Changed default ports and port names to avoid collisions during 1.6-to-1.8 upgrades
  - 10808 -> 10908
  - 8081 -> 8082
  - 8001 -> 8002
  - “proxy” -> “ingress”
  - “metrics” -> “stats”
- Changed secrets greymatter-sync-secret, oidc-client-secret, gm-edge-ingress-certs to greymatter-core-repo
  greymatter-oidc-provider, and greymatter-edge-ingress, respectively.

## v0.17.0 (March 29, 2023)

### Added

- Add SCC for proxy granting permission to use the SPIRE agent socket.

### Changed

- Updated versions of the cli, operator, proxy, control, control-api, proxy, and catalog.
- Split SPIRE resources config from SPIRE server.
- Rename observable references to audits in cue.
- Update cue submodule.
- Decrease operator readiness probe init delay.
- Expose k8s resource requests and limits in cue.

### Fixed

- If internal secret is different than the edge secret use that for internal TLS.

### Removed

- Removed PriorityClass from ControlEnsemble and the associated permissions required for the operator.
- Remove host_mount_socket toggle as it is always true.

## 0.16.6 (March 2, 2023)

### Changed

- Bumped operator version to 0.16.6

## 0.16.5 (March 2, 2023)

### Changed

- Bumped CLI version to 4.7.7 in inputs.cue

## 0.16.4 (March 1, 2023)

### Fixed

- Fixed one way TLS connections presenting a `trust_file` when they shouldn't.

### Added

- Added `mesh.spec.display_name` for Catalog mesh name
- PriorityClass for ControlEnsemble
- Introduced support for defining filter/mesh secrets as `#KubernetesSecret` or `#PlaintextSecret`. This enables users
  to read secrets from the environment given one of the supported formats. Note, plaintext secrets should remain
  undocumented and used for internal development only.

### Changed

- Changed operator package from `v1alpha1` to `meshv1`
- Default resource requests and limits to match 300 services benchmarks
- Bumped CLI version to 4.7.6
- Bumped Control and Control-Api version to 1.8.10
- Bumped Greymatter Data Store Redis to 7.0.8

## 0.16.3 (February 1, 2023)

### Changed

- Bumped CLI version to 4.7.5
- Bumped proxy version to 1.8.6
- Bumped operator version to 0.16.3

### Fixed

- Fixed redis running as root user
- Fixed vector support for openshift

## 0.16.2 (January 26, 2023)

### Changed

- Updated cli version to 4.7.4

### Removed

- Removed unused port 9090 from Vector DaemonSet

## 0.16.1 (January 23, 2023)

## Fixed

- Pipeline release generated assets

## 0.16.0 (January 20, 2023)

## Changed

- Updated operator, cli, dashboard, proxy, and control/control-api default images

## Fixed

- TLS and mTLS cue logic between audits app and external elastic search

## 0.15.0 (January 13, 2023)

### Added

- Added more toggles for audit app configs
- Auto-generation of operator manifests
- Added tests for TLS and mTLS scenarios

### Changed

- Improved security toggles for TLS and mTLS scenarios throughout the mesh
- Include SSH_KNOWN_HOSTS environment variable in Operator's StatefulSet
- Bump dockerfile base image to ironbank ubi 8.7

### Fixed

- Added transport_api_version to grpc_service configs
- Switched from `localhost` to `127.0.0.1` for the default elasticsearch host to prevent Control from going into a nack
  loop

## v0.14.0 (December 2nd, 2022)

### Changed

- automate release
- Update all images to targets for RC6

## 0.13.3 (November 22nd, 2022)

### Added

- Added toggle for elasticsearch tls cert verification
- Added auto generation of operator manifests

### Changed

- Updated images
- Updated jwks configs
- Spire enabled takes precedence over manual PKI
- Updated keycloak integration
- Enabled operator manage full lifecycle of deployments and configmaps
- Removed backed in manifest files

## 0.13.2 (November 15th, 2022)

### Changed

- Changed the order that operator resources are created
- Remove "plus" from default watched namespaces

## 0.13.1 (November 9th, 2022)

### Changed

- Regenerated operator.yaml and operator_withspire.yaml

## 0.13.0 (November 9th, 2022)

### Added

- Defaults for Elasticsearch configuration

### Changed

- Update egress from greymatter-audits to Elasticsearch to use TLS
- Observables to greymatter-audits
- Greymatter components are pulling from Artifactory by default
- Update default Prometheus version
- Explictly define default Redis version

## 0.12.0 (October 31st, 2022)

### Added

- Add CI configuration for testing builds and publishing releases

### Changed

- Prometheus and Redis now pulling from Quay because of Docker Hub rate limiting
- Replaced `+` with `list.Concat` in long concatenations to improve performance

### Fixed

- OpenShift support for Prometheus and Vector
- Regression where observables pipeline egress cluster looked for non-existent certificates

## 0.11.0 (October 4th, 2022)

### Added

- Updated `gm_oidc-authentication` filter to support pre/post Keycloak v17
- Added or increased support for TLS config Bon `oidc-authentication` and `oidc-validation`
- Integration tests for gitops, multi-operator deployment, and sidecar injection
- Automatically reorder enabled filters to enforce correct behavior.
- Eased manually-mounted mTLS certificates for internal mTLS (options now in inputs.cue)

### Changed

- `mesh.spec.zone` now defaults to `"default-zone"`
- Change TLS default for `oidc-authentication` and `oidc-validation` filters to true.

### Fixed

- Prevent warnings during operator.yaml manifest application by removing namespace creations from the manifests (which
  were duplicates of user-created namespaces described in the documentation)

### Removed

- Removed deprecated generate_webhook_certs value from inputs.cue

## 0.10.0 (September 13, 2022)

### Changed

- Mesh CRD, webhooks, and associated permissions removed
- Removed `zone` from inputs.cue to prevent breaking mesh changes

### Fixed

- Fixed ability to override CircuitBreakers per service

### Added

- Added support for an external Prometheus
- Added better comments to gm/outputs/intermediates.cue
- Operator namespace is now configurable
- Set default Kubernetes resource requests
- Updated greymatter-cue to
  https://github.com/greymatter-io/greymatter-cue/commit/2f3119ff1af7061f833b9fdeab8549a1b318d957
- Added support for external Spire
- Added audit pipeline confgurations
- Add JWT Security filter and service toggles

## 0.9.3 (August 11, 2022)

### Changed

- Stable release with gm-operator v0.9.3
