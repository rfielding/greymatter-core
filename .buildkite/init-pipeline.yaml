agents:
  queue: k8s-agent

steps:
  # Build the build image will will do that if there is an update to the dockerfile or pipeline
  - label: ":pipeline: Check For Changes To The Build Image"
    plugins:
      - monebag/monorepo-diff#v2.5.8:
          interpolation: false
          watch:
            - path:
                - ".buildkite/dockerfiles/"
                - ".buildkite/workload_pipelines/build-image.yaml"
              config:
                command: buildkite-agent pipeline upload .buildkite/workload-pipelines/build-image.yaml
                label: ":pipeline:"
  - wait

  - label: ":pipeline: Default Build"
    command: buildkite-agent pipeline upload .buildkite/workload-pipelines/pipeline.yaml
